<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { 
    font-family: Arial, sans-serif; 
    margin: 40px; 
}

.qrBlock {
    display: inline-block;
    text-align: center;
    border: 1px solid #ddd;
    padding: 10px;
    margin: 8px;
    width: 300px;
    border-radius: 6px;
    background: #fafafa;
}

.qrNameLabel {
    font-weight: bold;
    margin-bottom: 5px;
}

/* PRINT MODE */
@media print {
    body * { visibility: hidden; }
    #qrContainer, #qrContainer * { visibility: visible; }

    #qrContainer {
        position: absolute;
        left: 0;
        top: 0;
        margin: 0;
    }

    .qrBlock {
        page-break-inside: avoid;
        border: 1px solid black;
    }
}
</style>
</head>
<body>

<h2>Admin Panel</h2>

<label class="mt-2">Enter comma-separated names</label>
<input id="namesInput" class="form-control" placeholder="Rachel, Bob, Mom, Dad">

<label class="mt-3">Photo Sheet ID</label>
<input id="photoSheetInput" class="form-control" placeholder="Google Sheet ID">

<button class="btn btn-primary mt-3" onclick="generateAll()">Generate All</button>
<button class="btn btn-danger mt-3" onclick="window.print()">Print All</button>

<hr>

<div id="qrContainer"></div>

<script>
function getBaseVisitorURL() {
    const url = window.location.origin + window.location.pathname;
    return url.replace("admin.html", "visitor.html");
}

function generateAll(){
    const base = getBaseVisitorURL();
    const input = document.getElementById("namesInput").value;
    const sheetID = document.getElementById("photoSheetInput").value.trim();

    if (!input.trim()) {
        alert("Enter at least one name");
        return;
    }
    if (!sheetID) {
        alert("Enter a photo sheet ID");
        return;
    }

    const names = input.split(",").map(n => n.trim()).filter(n => n.length > 0);

    const container = document.getElementById("qrContainer");
    container.innerHTML = "";

    names.forEach(name => {
        const finalURL = `${base}?name=${encodeURIComponent(name)}&photos=${encodeURIComponent(sheetID)}`;

        // Create wrapper
        const div = document.createElement("div");
        div.className = "qrBlock";

        // Name label
        const label = document.createElement("div");
        label.className = "qrNameLabel";
        label.textContent = name;
        div.appendChild(label);

        // QR container
        const qrDiv = document.createElement("div");
        div.appendChild(qrDiv);

        // Generate QR for each
        new QRCode(qrDiv, {
            text: finalURL,
            width: 256,
            height: 256
        });

        // Display URL text (small)
        const link = document.createElement("div");
        link.style.fontSize = "10px";
        link.style.wordWrap = "break-word";
        link.textContent = finalURL;
        div.appendChild(link);

        // Append to main container
        container.appendChild(div);
    });
}
</script>

</body>
</html>

